"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getParticipants = exports.iterParticipants = exports._ParticipantsIter = void 0;
const Helpers_1 = require("../Helpers");
const requestIter_1 = require("../requestIter");
const __1 = require("../");
const tl_1 = require("../tl");
const big_integer_1 = __importDefault(require("big-integer"));
const _MAX_PARTICIPANTS_CHUNK_SIZE = 200;
const _MAX_ADMIN_LOG_CHUNK_SIZE = 100;
const _MAX_PROFILE_PHOTO_CHUNK_SIZE = 100;
class _ChatAction {
    constructor(client, chat, action, params = {
        delay: 4,
        autoCancel: true,
    }) {
        this._client = client;
        this._chat = chat;
        this._action = action;
        this._delay = params.delay;
        this.autoCancel = params.autoCancel;
        this._request = undefined;
        this._task = null;
        this._running = false;
    }
    start() {
        return __awaiter(this, void 0, void 0, function* () {
            this._request = new tl_1.Api.messages.SetTyping({
                peer: this._chat,
                action: this._action
            });
            this._running = true;
            this._update();
        });
    }
    stop() {
        return __awaiter(this, void 0, void 0, function* () {
            this._running = false;
            if (this.autoCancel) {
                yield this._client.invoke(new tl_1.Api.messages.SetTyping({
                    peer: this._chat,
                    action: new tl_1.Api.SendMessageCancelAction()
                }));
            }
        });
    }
    _update() {
        return __awaiter(this, void 0, void 0, function* () {
            while (this._running) {
                if (this._request != undefined) {
                    yield this._client.invoke(this._request);
                }
                yield Helpers_1.sleep(this._delay * 1000);
            }
        });
    }
    progress(current, total) {
        if ('progress' in this._action) {
            this._action.progress = 100 * Math.round(current / total);
        }
    }
}
_ChatAction._str_mapping = {
    'typing': new tl_1.Api.SendMessageTypingAction(),
    'contact': new tl_1.Api.SendMessageChooseContactAction(),
    'game': new tl_1.Api.SendMessageGamePlayAction(),
    'location': new tl_1.Api.SendMessageGeoLocationAction(),
    'record-audio': new tl_1.Api.SendMessageRecordAudioAction(),
    'record-voice': new tl_1.Api.SendMessageRecordAudioAction(),
    'record-round': new tl_1.Api.SendMessageRecordRoundAction(),
    'record-video': new tl_1.Api.SendMessageRecordVideoAction(),
    'audio': new tl_1.Api.SendMessageUploadAudioAction({ progress: 1, }),
    'voice': new tl_1.Api.SendMessageUploadAudioAction({ progress: 1, }),
    'song': new tl_1.Api.SendMessageUploadAudioAction({ progress: 1, }),
    'round': new tl_1.Api.SendMessageUploadRoundAction({ progress: 1, }),
    'video': new tl_1.Api.SendMessageUploadVideoAction({ progress: 1, }),
    'photo': new tl_1.Api.SendMessageUploadPhotoAction({ progress: 1, }),
    'document': new tl_1.Api.SendMessageUploadDocumentAction({ progress: 1, }),
    'file': new tl_1.Api.SendMessageUploadDocumentAction({ progress: 1, }),
    'cancel': new tl_1.Api.SendMessageCancelAction()
};
class _ParticipantsIter extends requestIter_1.RequestIter {
    _init({ entity, filter, search }) {
        var _a, _b;
        return __awaiter(this, void 0, void 0, function* () {
            if (filter && filter.constructor === Function) {
                if ([tl_1.Api.ChannelParticipantsBanned, tl_1.Api.ChannelParticipantsKicked, tl_1.Api.ChannelParticipantsSearch, tl_1.Api.ChannelParticipantsContacts].includes(filter)) {
                    filter = new filter({
                        q: '',
                    });
                }
                else {
                    filter = new filter();
                }
            }
            entity = yield this.client.getInputEntity(entity);
            const ty = __1.helpers._entityType(entity);
            if (search && (filter || ty != __1.helpers._EntityType.CHANNEL)) {
                // We need to 'search' ourselves unless we have a PeerChannel
                search = search.toLowerCase();
                this.filterEntity = (entity) => {
                    return __1.utils.getDisplayName(entity).toLowerCase().includes(search) ||
                        ('username' in entity ? entity.username || '' : '').toLowerCase().includes(search);
                };
            }
            else {
                this.filterEntity = (entity) => true;
            }
            // Only used for channels, but we should always set the attribute
            this.requests = [];
            if (ty == __1.helpers._EntityType.CHANNEL) {
                const channel = (yield this.client.invoke(new tl_1.Api.channels.GetFullChannel({
                    channel: entity
                })));
                if (!(channel.fullChat instanceof tl_1.Api.ChatFull)) {
                    this.total = channel.fullChat.participantsCount;
                }
                if (this.total && this.total <= 0) {
                    return false;
                }
                this.requests.push(new tl_1.Api.channels.GetParticipants({
                    channel: entity,
                    filter: filter || new tl_1.Api.ChannelParticipantsSearch({
                        q: search || '',
                    }),
                    offset: 0,
                    limit: _MAX_PARTICIPANTS_CHUNK_SIZE,
                    hash: 0,
                }));
            }
            else if (ty == __1.helpers._EntityType.CHAT) {
                if (!("chatId" in entity)) {
                    throw new Error("Found chat without id " + JSON.stringify(entity));
                }
                const full = yield this.client.invoke(new tl_1.Api.messages.GetFullChat({
                    chatId: entity.chatId
                }));
                if (full.fullChat instanceof tl_1.Api.ChatFull) {
                    if (!(full.fullChat.participants instanceof tl_1.Api.ChatParticipantsForbidden)) {
                        this.total = full.fullChat.participants.participants.length;
                    }
                    else {
                        this.total = 0;
                        return false;
                    }
                    const users = new Map();
                    for (const user of full.users) {
                        users.set(user.id, user);
                    }
                    for (const participant of full.fullChat.participants.participants) {
                        const user = users.get(participant.userId);
                        if (!this.filterEntity(user)) {
                            continue;
                        }
                        user.participant = participant;
                        (_a = this.buffer) === null || _a === void 0 ? void 0 : _a.push(user);
                    }
                    return true;
                }
            }
            else {
                this.total = 1;
                if (this.limit != 0) {
                    const user = yield this.client.getEntity(entity);
                    if (this.filterEntity(user)) {
                        // @ts-ignore
                        user.participant = null;
                        (_b = this.buffer) === null || _b === void 0 ? void 0 : _b.push(user);
                    }
                }
                return true;
            }
        });
    }
    _loadNextChunk() {
        var _a, _b;
        return __awaiter(this, void 0, void 0, function* () {
            if (!((_a = this.requests) === null || _a === void 0 ? void 0 : _a.length)) {
                return true;
            }
            this.requests[0].limit = Math.min(this.limit - this.requests[0].offset, _MAX_PARTICIPANTS_CHUNK_SIZE);
            if (this.requests[0].offset > this.limit) {
                return true;
            }
            const results = [];
            for (const request of this.requests) {
                results.push(yield this.client.invoke(request));
            }
            for (let i = this.requests.length - 1; i >= 0; i--) {
                const participants = results[i];
                if (participants instanceof tl_1.Api.channels.ChannelParticipantsNotModified || !participants.users.length) {
                    this.requests.splice(i, 1);
                    continue;
                }
                this.requests[i].offset += participants.participants.length;
                const users = new Map();
                for (const user of participants.users) {
                    users.set(user.id, user);
                }
                for (const participant of participants.participants) {
                    const user = users.get(participant.userId);
                    if (this.filterEntity && !this.filterEntity(user)) {
                        continue;
                    }
                    user.participant = participant;
                    (_b = this.buffer) === null || _b === void 0 ? void 0 : _b.push(user);
                }
            }
            return undefined;
        });
    }
    [Symbol.asyncIterator]() {
        return super[Symbol.asyncIterator]();
    }
}
exports._ParticipantsIter = _ParticipantsIter;
class _AdminLogIter extends requestIter_1.RequestIter {
    _init(entity, searchArgs, filterArgs) {
        return __awaiter(this, void 0, void 0, function* () {
            let eventsFilter = undefined;
            if (filterArgs && Object.values(filterArgs).find(element => element === true)) {
                eventsFilter = new tl_1.Api.ChannelAdminLogEventsFilter(Object.assign({}, filterArgs));
            }
            this.entity = yield this.client.getInputEntity(entity);
            const adminList = [];
            if (searchArgs && searchArgs.admins) {
                for (const admin of searchArgs.admins) {
                    adminList.push(yield this.client.getInputEntity(admin));
                }
            }
            this.request = new tl_1.Api.channels.GetAdminLog({
                channel: this.entity,
                q: (searchArgs === null || searchArgs === void 0 ? void 0 : searchArgs.search) || '',
                minId: searchArgs === null || searchArgs === void 0 ? void 0 : searchArgs.minId,
                maxId: searchArgs === null || searchArgs === void 0 ? void 0 : searchArgs.maxId,
                limit: 0,
                eventsFilter: eventsFilter,
                admins: adminList || undefined,
            });
        });
    }
    _loadNextChunk() {
        return __awaiter(this, void 0, void 0, function* () {
            if (!this.request) {
                return true;
            }
            this.request.limit = Math.min(this.left, _MAX_ADMIN_LOG_CHUNK_SIZE);
            const r = yield this.client.invoke(this.request);
            const entities = new Map();
            for (const entity of [...r.users, ...r.chats]) {
                entities.set(__1.utils.getPeerId(entity), entity);
            }
            const eventIds = [];
            for (const e of r.events) {
                eventIds.push(e.id);
            }
            this.request.maxId = Helpers_1.getMinBigInt([big_integer_1.default.zero, ...eventIds]);
            for (const ev of r.events) {
                if (ev.action instanceof tl_1.Api.ChannelAdminLogEventActionEditMessage) {
                    // @ts-ignore
                    // TODO ev.action.prevMessage._finishInit(this.client, entities, this.entity);
                    // @ts-ignore
                    // TODO ev.action.newMessage._finishInit(this.client, entities, this.entity);
                }
            }
        });
    }
}
function iterParticipants(client, entity, { limit, search, filter, }) {
    return new _ParticipantsIter(client, limit !== null && limit !== void 0 ? limit : Number.MAX_SAFE_INTEGER, {}, {
        entity: entity,
        filter: filter,
        search: search
    });
}
exports.iterParticipants = iterParticipants;
function getParticipants(client, entity, params) {
    return __awaiter(this, void 0, void 0, function* () {
        const it = client.iterParticipants(entity, params);
        return yield it.collect();
    });
}
exports.getParticipants = getParticipants;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhdHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9ncmFtanMvY2xpZW50L2NoYXRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUVBLHdDQUEwRDtBQUMxRCxnREFBMkM7QUFDM0MsMkJBQW1DO0FBQ25DLDhCQUEwQjtBQUMxQiw4REFBK0M7QUFHL0MsTUFBTSw0QkFBNEIsR0FBRyxHQUFHLENBQUM7QUFDekMsTUFBTSx5QkFBeUIsR0FBRyxHQUFHLENBQUM7QUFDdEMsTUFBTSw2QkFBNkIsR0FBRyxHQUFHLENBQUM7QUFPMUMsTUFBTSxXQUFXO0lBa0NiLFlBQVksTUFBc0IsRUFBRSxJQUFnQixFQUFFLE1BQWdELEVBQUUsU0FBOEI7UUFDbEksS0FBSyxFQUFFLENBQUM7UUFDUixVQUFVLEVBQUUsSUFBSTtLQUNuQjtRQUNHLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUMzQixJQUFJLENBQUMsVUFBVSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUM7UUFDcEMsSUFBSSxDQUFDLFFBQVEsR0FBRyxTQUFTLENBQUM7UUFDMUIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDMUIsQ0FBQztJQUVLLEtBQUs7O1lBQ1AsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLFFBQUcsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDO2dCQUN2QyxJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUs7Z0JBQ2hCLE1BQU0sRUFBRSxJQUFJLENBQUMsT0FBTzthQUN2QixDQUFDLENBQUM7WUFDSCxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztZQUNyQixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDbkIsQ0FBQztLQUFBO0lBRUssSUFBSTs7WUFDTixJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztZQUN0QixJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7Z0JBQ2pCLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxRQUFHLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQztvQkFDakQsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLO29CQUNoQixNQUFNLEVBQUUsSUFBSSxRQUFHLENBQUMsdUJBQXVCLEVBQUU7aUJBQzVDLENBQUMsQ0FBQyxDQUFDO2FBQ1A7UUFDTCxDQUFDO0tBQUE7SUFFSyxPQUFPOztZQUNULE9BQU8sSUFBSSxDQUFDLFFBQVEsRUFBRTtnQkFDbEIsSUFBSSxJQUFJLENBQUMsUUFBUSxJQUFJLFNBQVMsRUFBRTtvQkFDNUIsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7aUJBQzVDO2dCQUNELE1BQU0sZUFBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUM7YUFDbkM7UUFFTCxDQUFDO0tBQUE7SUFFRCxRQUFRLENBQUMsT0FBZSxFQUFFLEtBQWE7UUFDbkMsSUFBSSxVQUFVLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUM1QixJQUFJLENBQUMsT0FBTyxDQUFDLFFBQVEsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDLENBQUE7U0FDNUQ7SUFFTCxDQUFDOztBQWpGTSx3QkFBWSxHQUFHO0lBQ2xCLFFBQVEsRUFBRSxJQUFJLFFBQUcsQ0FBQyx1QkFBdUIsRUFBRTtJQUMzQyxTQUFTLEVBQUUsSUFBSSxRQUFHLENBQUMsOEJBQThCLEVBQUU7SUFDbkQsTUFBTSxFQUFFLElBQUksUUFBRyxDQUFDLHlCQUF5QixFQUFFO0lBQzNDLFVBQVUsRUFBRSxJQUFJLFFBQUcsQ0FBQyw0QkFBNEIsRUFBRTtJQUVsRCxjQUFjLEVBQUUsSUFBSSxRQUFHLENBQUMsNEJBQTRCLEVBQUU7SUFDdEQsY0FBYyxFQUFFLElBQUksUUFBRyxDQUFDLDRCQUE0QixFQUFFO0lBQ3RELGNBQWMsRUFBRSxJQUFJLFFBQUcsQ0FBQyw0QkFBNEIsRUFBRTtJQUN0RCxjQUFjLEVBQUUsSUFBSSxRQUFHLENBQUMsNEJBQTRCLEVBQUU7SUFFdEQsT0FBTyxFQUFFLElBQUksUUFBRyxDQUFDLDRCQUE0QixDQUFDLEVBQUMsUUFBUSxFQUFFLENBQUMsR0FBRSxDQUFDO0lBQzdELE9BQU8sRUFBRSxJQUFJLFFBQUcsQ0FBQyw0QkFBNEIsQ0FBQyxFQUFDLFFBQVEsRUFBRSxDQUFDLEdBQUUsQ0FBQztJQUM3RCxNQUFNLEVBQUUsSUFBSSxRQUFHLENBQUMsNEJBQTRCLENBQUMsRUFBQyxRQUFRLEVBQUUsQ0FBQyxHQUFFLENBQUM7SUFDNUQsT0FBTyxFQUFFLElBQUksUUFBRyxDQUFDLDRCQUE0QixDQUFDLEVBQUMsUUFBUSxFQUFFLENBQUMsR0FBRSxDQUFDO0lBQzdELE9BQU8sRUFBRSxJQUFJLFFBQUcsQ0FBQyw0QkFBNEIsQ0FBQyxFQUFDLFFBQVEsRUFBRSxDQUFDLEdBQUUsQ0FBQztJQUU3RCxPQUFPLEVBQUUsSUFBSSxRQUFHLENBQUMsNEJBQTRCLENBQUMsRUFBQyxRQUFRLEVBQUUsQ0FBQyxHQUFFLENBQUM7SUFDN0QsVUFBVSxFQUFFLElBQUksUUFBRyxDQUFDLCtCQUErQixDQUFDLEVBQUMsUUFBUSxFQUFFLENBQUMsR0FBRSxDQUFDO0lBQ25FLE1BQU0sRUFBRSxJQUFJLFFBQUcsQ0FBQywrQkFBK0IsQ0FBQyxFQUFDLFFBQVEsRUFBRSxDQUFDLEdBQUUsQ0FBQztJQUUvRCxRQUFRLEVBQUUsSUFBSSxRQUFHLENBQUMsdUJBQXVCLEVBQUU7Q0FDOUMsQ0FBQztBQW9FTixNQUFhLGlCQUFrQixTQUFRLHlCQUFXO0lBSXhDLEtBQUssQ0FBQyxFQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUE0Qjs7O1lBQzNELElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxXQUFXLEtBQUssUUFBUSxFQUFFO2dCQUMzQyxJQUFJLENBQUMsUUFBRyxDQUFDLHlCQUF5QixFQUFFLFFBQUcsQ0FBQyx5QkFBeUIsRUFBRSxRQUFHLENBQUMseUJBQXlCLEVBQUUsUUFBRyxDQUFDLDJCQUEyQixDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFO29CQUNqSixNQUFNLEdBQUcsSUFBSSxNQUFNLENBQUM7d0JBQ2hCLENBQUMsRUFBRSxFQUFFO3FCQUNSLENBQUMsQ0FBQztpQkFDTjtxQkFBTTtvQkFDSCxNQUFNLEdBQUcsSUFBSSxNQUFNLEVBQUUsQ0FBQztpQkFDekI7YUFDSjtZQUNELE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2xELE1BQU0sRUFBRSxHQUFHLFdBQU8sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdkMsSUFBSSxNQUFNLElBQUksQ0FBQyxNQUFNLElBQUksRUFBRSxJQUFJLFdBQU8sQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQ3pELDZEQUE2RDtnQkFDN0QsTUFBTSxHQUFHLE1BQU0sQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDOUIsSUFBSSxDQUFDLFlBQVksR0FBRyxDQUFDLE1BQWMsRUFBRSxFQUFFO29CQUNuQyxPQUFPLFNBQUssQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFTLE1BQU0sQ0FBQzt3QkFDdEUsQ0FBQyxVQUFVLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFTLE1BQU0sQ0FBQyxDQUFBO2dCQUNsRyxDQUFDLENBQUE7YUFDSjtpQkFBTTtnQkFDSCxJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsTUFBYyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUM7YUFDaEQ7WUFDRCxpRUFBaUU7WUFDakUsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7WUFDbkIsSUFBSSxFQUFFLElBQUksV0FBTyxDQUFDLFdBQVcsQ0FBQyxPQUFPLEVBQUU7Z0JBQ25DLE1BQU0sT0FBTyxHQUFHLENBQUMsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLFFBQUcsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDO29CQUN0RSxPQUFPLEVBQUUsTUFBTTtpQkFDbEIsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDTCxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsUUFBUSxZQUFZLFFBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRTtvQkFDN0MsSUFBSSxDQUFDLEtBQUssR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLGlCQUFpQixDQUFDO2lCQUNuRDtnQkFDRCxJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLEVBQUU7b0JBQy9CLE9BQU8sS0FBSyxDQUFDO2lCQUNoQjtnQkFDRCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLFFBQUcsQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDO29CQUNoRCxPQUFPLEVBQUUsTUFBTTtvQkFDZixNQUFNLEVBQUUsTUFBTSxJQUFJLElBQUksUUFBRyxDQUFDLHlCQUF5QixDQUFDO3dCQUNoRCxDQUFDLEVBQUUsTUFBTSxJQUFJLEVBQUU7cUJBQ2xCLENBQUM7b0JBQ0YsTUFBTSxFQUFFLENBQUM7b0JBQ1QsS0FBSyxFQUFFLDRCQUE0QjtvQkFDbkMsSUFBSSxFQUFFLENBQUM7aUJBQ1YsQ0FBQyxDQUFDLENBQUE7YUFDTjtpQkFBTSxJQUFJLEVBQUUsSUFBSSxXQUFPLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRTtnQkFDdkMsSUFBSSxDQUFDLENBQUMsUUFBUSxJQUFJLE1BQU0sQ0FBQyxFQUFFO29CQUN2QixNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztpQkFDdEU7Z0JBQ0QsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLFFBQUcsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDO29CQUMvRCxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU07aUJBQ3hCLENBQUMsQ0FBQyxDQUFDO2dCQUVKLElBQUksSUFBSSxDQUFDLFFBQVEsWUFBWSxRQUFHLENBQUMsUUFBUSxFQUFFO29CQUN2QyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksWUFBWSxRQUFHLENBQUMseUJBQXlCLENBQUMsRUFBRTt3QkFDeEUsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDO3FCQUMvRDt5QkFBTTt3QkFDSCxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQzt3QkFDZixPQUFPLEtBQUssQ0FBQztxQkFDaEI7b0JBRUQsTUFBTSxLQUFLLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztvQkFDeEIsS0FBSyxNQUFNLElBQUksSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO3dCQUMzQixLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7cUJBQzVCO29CQUNELEtBQUssTUFBTSxXQUFXLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsWUFBWSxFQUFFO3dCQUMvRCxNQUFNLElBQUksR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQzt3QkFDM0MsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUU7NEJBQzFCLFNBQVM7eUJBQ1o7d0JBQ0QsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7d0JBQy9CLE1BQUEsSUFBSSxDQUFDLE1BQU0sMENBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO3FCQUMzQjtvQkFDRCxPQUFPLElBQUksQ0FBQztpQkFDZjthQUVKO2lCQUFNO2dCQUNILElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO2dCQUNmLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLEVBQUU7b0JBQ2pCLE1BQU0sSUFBSSxHQUFHLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQ2pELElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRTt3QkFDekIsYUFBYTt3QkFDYixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQzt3QkFDeEIsTUFBQSxJQUFJLENBQUMsTUFBTSwwQ0FBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7cUJBQzNCO2lCQUNKO2dCQUNELE9BQU8sSUFBSSxDQUFDO2FBQ2Y7O0tBQ0o7SUFFSyxjQUFjOzs7WUFDaEIsSUFBSSxDQUFDLENBQUEsTUFBQSxJQUFJLENBQUMsUUFBUSwwQ0FBRSxNQUFNLENBQUEsRUFBRTtnQkFDeEIsT0FBTyxJQUFJLENBQUM7YUFDZjtZQUNELElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQzdCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsNEJBQTRCLENBQ3JFLENBQUM7WUFDRixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLEVBQUU7Z0JBQ3RDLE9BQU8sSUFBSSxDQUFDO2FBQ2Y7WUFDRCxNQUFNLE9BQU8sR0FBRyxFQUFFLENBQUM7WUFDbkIsS0FBSyxNQUFNLE9BQU8sSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFO2dCQUNqQyxPQUFPLENBQUMsSUFBSSxDQUNSLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQ3BDLENBQUM7YUFDTDtZQUVELEtBQUssSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUU7Z0JBQ2hELE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDaEMsSUFBSSxZQUFZLFlBQVksUUFBRyxDQUFDLFFBQVEsQ0FBQyw4QkFBOEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFO29CQUNuRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQzNCLFNBQVM7aUJBQ1o7Z0JBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLElBQUksWUFBWSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUM7Z0JBQzVELE1BQU0sS0FBSyxHQUFHLElBQUksR0FBRyxFQUFFLENBQUM7Z0JBQ3hCLEtBQUssTUFBTSxJQUFJLElBQUksWUFBWSxDQUFDLEtBQUssRUFBRTtvQkFDbkMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDO2lCQUM1QjtnQkFDRCxLQUFLLE1BQU0sV0FBVyxJQUFJLFlBQVksQ0FBQyxZQUFZLEVBQUU7b0JBQ2pELE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUMzQyxJQUFJLElBQUksQ0FBQyxZQUFZLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFO3dCQUMvQyxTQUFTO3FCQUNaO29CQUNELElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO29CQUMvQixNQUFBLElBQUksQ0FBQyxNQUFNLDBDQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztpQkFDM0I7YUFDSjtZQUNELE9BQU8sU0FBUyxDQUFDOztLQUNwQjtJQUVELENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQztRQUNsQixPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztJQUN6QyxDQUFDO0NBRUo7QUF4SUQsOENBd0lDO0FBMkJELE1BQU0sYUFBYyxTQUFRLHlCQUFXO0lBSTdCLEtBQUssQ0FBQyxNQUFrQixFQUFFLFVBQXFDLEVBQUUsVUFBcUM7O1lBQ3hHLElBQUksWUFBWSxHQUFHLFNBQVMsQ0FBQztZQUU3QixJQUFJLFVBQVUsSUFBSSxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE9BQU8sS0FBSyxJQUFJLENBQUMsRUFBRTtnQkFDM0UsWUFBWSxHQUFHLElBQUksUUFBRyxDQUFDLDJCQUEyQixtQkFDM0MsVUFBVSxFQUNmLENBQUM7YUFDTjtZQUNELElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN2RCxNQUFNLFNBQVMsR0FBRyxFQUFFLENBQUE7WUFDcEIsSUFBSSxVQUFVLElBQUksVUFBVSxDQUFDLE1BQU0sRUFBRTtnQkFDakMsS0FBSyxNQUFNLEtBQUssSUFBSSxVQUFVLENBQUMsTUFBTSxFQUFFO29CQUNuQyxTQUFTLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQTtpQkFDMUQ7YUFDSjtZQUNELElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxRQUFHLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQztnQkFDcEMsT0FBTyxFQUFFLElBQUksQ0FBQyxNQUFNO2dCQUNwQixDQUFDLEVBQUUsQ0FBQSxVQUFVLGFBQVYsVUFBVSx1QkFBVixVQUFVLENBQUUsTUFBTSxLQUFJLEVBQUU7Z0JBQzNCLEtBQUssRUFBRSxVQUFVLGFBQVYsVUFBVSx1QkFBVixVQUFVLENBQUUsS0FBSztnQkFDeEIsS0FBSyxFQUFFLFVBQVUsYUFBVixVQUFVLHVCQUFWLFVBQVUsQ0FBRSxLQUFLO2dCQUN4QixLQUFLLEVBQUUsQ0FBQztnQkFDUixZQUFZLEVBQUUsWUFBWTtnQkFDMUIsTUFBTSxFQUFFLFNBQVMsSUFBSSxTQUFTO2FBQ2pDLENBQ0osQ0FBQTtRQUNMLENBQUM7S0FBQTtJQUVLLGNBQWM7O1lBQ2hCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFO2dCQUNmLE9BQU8sSUFBSSxDQUFDO2FBQ2Y7WUFDRCxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUseUJBQXlCLENBQUMsQ0FBQztZQUNwRSxNQUFNLENBQUMsR0FBRyxNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNqRCxNQUFNLFFBQVEsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBQzNCLEtBQUssTUFBTSxNQUFNLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQzNDLFFBQVEsQ0FBQyxHQUFHLENBQUMsU0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQzthQUNqRDtZQUNELE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQztZQUNwQixLQUFLLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUU7Z0JBQ3RCLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2FBQ3ZCO1lBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsc0JBQVksQ0FBQyxDQUFDLHFCQUFNLENBQUMsSUFBSSxFQUFFLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUM5RCxLQUFLLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUU7Z0JBQ3ZCLElBQUksRUFBRSxDQUFDLE1BQU0sWUFBWSxRQUFHLENBQUMscUNBQXFDLEVBQUU7b0JBQ2hFLGFBQWE7b0JBQ2IsOEVBQThFO29CQUM5RSxhQUFhO29CQUNiLDZFQUE2RTtpQkFFaEY7YUFDSjtRQUNMLENBQUM7S0FBQTtDQUNKO0FBU0QsU0FBZ0IsZ0JBQWdCLENBQUMsTUFBc0IsRUFBRSxNQUFrQixFQUFFLEVBQ3pFLEtBQUssRUFDTCxNQUFNLEVBQ04sTUFBTSxHQUNlO0lBQ3JCLE9BQU8sSUFBSSxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsS0FBSyxhQUFMLEtBQUssY0FBTCxLQUFLLEdBQUksTUFBTSxDQUFDLGdCQUFnQixFQUFFLEVBQUUsRUFDckU7UUFDSSxNQUFNLEVBQUUsTUFBTTtRQUNkLE1BQU0sRUFBRSxNQUFNO1FBQ2QsTUFBTSxFQUFFLE1BQU07S0FDakIsQ0FBQyxDQUFDO0FBQ1gsQ0FBQztBQVhELDRDQVdDO0FBRUQsU0FBc0IsZUFBZSxDQUFDLE1BQXNCLEVBQUUsTUFBa0IsRUFBRSxNQUE4Qjs7UUFDNUcsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNuRCxPQUFPLE1BQU0sRUFBRSxDQUFDLE9BQU8sRUFBeUIsQ0FBQztJQUNyRCxDQUFDO0NBQUE7QUFIRCwwQ0FHQyJ9