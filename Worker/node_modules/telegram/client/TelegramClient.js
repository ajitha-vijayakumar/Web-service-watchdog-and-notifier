"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.TelegramClient = void 0;
const telegramBaseClient_1 = require("./telegramBaseClient");
const authMethods = __importStar(require("./auth"));
const botMethods = __importStar(require("./bots"));
const buttonsMethods = __importStar(require("./buttons"));
const downloadMethods = __importStar(require("./downloads"));
const parseMethods = __importStar(require("./messageParse"));
const messageMethods = __importStar(require("./messages"));
const updateMethods = __importStar(require("./updates"));
const uploadMethods = __importStar(require("./uploads"));
const userMethods = __importStar(require("./users"));
const chatMethods = __importStar(require("./chats"));
const tl_1 = require("../tl");
const Utils_1 = require("../Utils");
const markdown_1 = require("../extensions/markdown");
const network_1 = require("../network");
const AllTLObjects_1 = require("../tl/AllTLObjects");
const Helpers_1 = require("../Helpers");
class TelegramClient extends telegramBaseClient_1.TelegramBaseClient {
    // region auth
    start(authParams) {
        return authMethods.start(this, authParams);
    }
    checkAuthorization() {
        return authMethods.checkAuthorization(this);
    }
    signInUser(apiCredentials, authParams) {
        return authMethods.signInUser(this, apiCredentials, authParams);
    }
    signInUserWithQrCode(apiCredentials, authParams) {
        return authMethods.signInUserWithQrCode(this, apiCredentials, authParams);
    }
    sendCode(apiCredentials, phoneNumber, forceSMS = false) {
        return authMethods.sendCode(this, apiCredentials, phoneNumber, forceSMS);
    }
    signInWithPassword(apiCredentials, authParams) {
        return authMethods.signInWithPassword(this, apiCredentials, authParams);
    }
    signInBot(apiCredentials, authParams) {
        return authMethods.signInBot(this, apiCredentials, authParams);
    }
    authFlow(apiCredentials, authParams) {
        return authMethods.authFlow(this, apiCredentials, authParams);
    }
    //endregion auth
    //region bot
    inlineQuery(bot, query, entity, offset, geoPoint) {
        return botMethods.inlineQuery(this, bot, query, entity, offset, geoPoint);
    }
    //endregion
    //region buttons
    buildReplyMarkup(buttons, inlineOnly = false) {
        return buttonsMethods.buildReplyMarkup(buttons, inlineOnly);
    }
    //endregion
    //region download
    downloadFile(inputLocation, fileParams) {
        return downloadMethods.downloadFile(this, inputLocation, fileParams);
    }
    _downloadPhoto(photo, args) {
        return downloadMethods._downloadPhoto(this, photo, args);
    }
    _downloadCachedPhotoSize(size) {
        return downloadMethods._downloadCachedPhotoSize(this, size);
    }
    _downloadDocument(media, args) {
        return downloadMethods._downloadDocument(this, media, args);
    }
    _downloadContact(contact, args) {
        return downloadMethods._downloadContact(this, contact, args);
    }
    _downloadWebDocument(webDocument, args) {
        return downloadMethods._downloadWebDocument(this, webDocument, args);
    }
    downloadMedia(messageOrMedia, args) {
        return downloadMethods.downloadMedia(this, messageOrMedia, args);
    }
    //endregion
    //region message parse
    get parseMode() {
        return this._parseMode || markdown_1.MarkdownParser;
    }
    setParseMode(mode) {
        this._parseMode = Utils_1.sanitizeParseMode(mode);
    }
    // private methods
    _replaceWithMention(entities, i, user) {
        return parseMethods._replaceWithMention(this, entities, i, user);
    }
    _parseMessageText(message, parseMode) {
        return parseMethods._parseMessageText(this, message, parseMode);
    }
    //endregion
    // region messages
    iterMessages(entity, params) {
        return messageMethods.iterMessages(this, entity, params);
    }
    getMessages(entity, params) {
        return messageMethods.getMessages(this, entity, params);
    }
    sendMessage(entity, params) {
        return messageMethods.sendMessage(this, entity, params);
    }
    //endregion
    //region chats
    iterParticipants(entity, params) {
        return chatMethods.iterParticipants(this, entity, params);
    }
    getParticipants(entity, params) {
        return chatMethods.getParticipants(this, entity, params);
    }
    //endregion
    //region updates
    on(event) {
        return updateMethods.on(this, event);
    }
    addEventHandler(callback, event) {
        return updateMethods.addEventHandler(this, callback, event);
    }
    removeEventHandler(callback, event) {
        return updateMethods.removeEventHandler(this, callback, event);
    }
    listEventHandlers() {
        return updateMethods.listEventHandlers(this);
    }
    // private methods
    _handleUpdate(update) {
        return updateMethods._handleUpdate(this, update);
    }
    _processUpdate(update, others, entities) {
        return updateMethods._processUpdate(this, update, others, entities);
    }
    _dispatchUpdate(args) {
        return updateMethods._dispatchUpdate(this, args);
    }
    _updateLoop() {
        return updateMethods._updateLoop(this);
    }
    //endregion
    // region uploads
    uploadFile(fileParams) {
        return uploadMethods.uploadFile(this, fileParams);
    }
    sendFile(entity, params) {
        return uploadMethods.sendFile(this, entity, params);
    }
    // endregion
    //region user methods
    invoke(request) {
        return userMethods.invoke(this, request);
    }
    getMe(inputPeer = false) {
        return userMethods.getMe(this, inputPeer);
    }
    isBot() {
        return userMethods.isBot(this);
    }
    isUserAuthorized() {
        return userMethods.isUserAuthorized(this);
    }
    getEntity(entity) {
        return userMethods.getEntity(this, entity);
    }
    getInputEntity(peer) {
        return userMethods.getInputEntity(this, peer);
    }
    getPeerId(peer, addMark = false) {
        return userMethods.getPeerId(this, peer, addMark);
    }
    // private methods
    _getEntityFromString(string) {
        return userMethods._getEntityFromString(this, string);
    }
    _getPeer(peer) {
        return userMethods._getPeer(this, peer);
    }
    _getInputDialog(dialog) {
        return userMethods._getInputDialog(this, dialog);
    }
    _getInputNotify(notify) {
        return userMethods._getInputNotify(this, notify);
    }
    //endregion
    //region base methods
    connect() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this._initSession();
            this._sender = new network_1.MTProtoSender(this.session.getAuthKey(), {
                logger: this._log,
                dcId: this.session.dcId || 4,
                retries: this._connectionRetries,
                delay: this._retryDelay,
                autoReconnect: this._autoReconnect,
                connectTimeout: this._timeout,
                authKeyCallback: this._authKeyCallback.bind(this),
                updateCallback: this._handleUpdate.bind(this),
                isMainSender: true,
            });
            const connection = new this._connection(this.session.serverAddress, this.session.port, this.session.dcId, this._log);
            if (!(yield this._sender.connect(connection, this._dispatchUpdate.bind(this)))) {
                return;
            }
            this.session.setAuthKey(this._sender.authKey);
            yield this.session.save();
            this._initRequest.query = new tl_1.Api.help.GetConfig();
            yield this._sender.send(new tl_1.Api.InvokeWithLayer({
                layer: AllTLObjects_1.LAYER,
                query: this._initRequest
            }));
            this._dispatchUpdate({ update: new network_1.UpdateConnectionState(1) });
            this._updateLoop();
        });
    }
    //endregion
    // region Working with different connections/Data Centers
    _switchDC(newDc) {
        return __awaiter(this, void 0, void 0, function* () {
            this._log.info(`Reconnecting to new data center ${newDc}`);
            const DC = yield this.getDC(newDc);
            this.session.setDC(newDc, DC.ipAddress, DC.port);
            // authKey's are associated with a server, which has now changed
            // so it's not valid anymore. Set to None to force recreating it.
            yield this._sender.authKey.setKey();
            this.session.setAuthKey();
            yield this.disconnect();
            return this.connect();
        });
    }
    _createExportedSender(dcId, retries) {
        return __awaiter(this, void 0, void 0, function* () {
            const dc = yield this.getDC(dcId);
            const sender = new network_1.MTProtoSender(this.session.getAuthKey(dcId), {
                logger: this._log,
                dcId: dcId,
                retries: this._connectionRetries,
                delay: this._retryDelay,
                autoReconnect: this._autoReconnect,
                connectTimeout: this._timeout,
                authKeyCallback: this._authKeyCallback.bind(this),
                isMainSender: dcId === this.session.dcId,
                senderCallback: this.removeSender.bind(this),
            });
            for (let i = 0; i < retries; i++) {
                try {
                    yield sender.connect(new this._connection(dc.ipAddress, dc.port, dcId, this._log));
                    if (this.session.dcId !== dcId) {
                        this._log.info(`Exporting authorization for data center ${dc.ipAddress}`);
                        const auth = yield this.invoke(new tl_1.Api.auth.ExportAuthorization({ dcId: dcId }));
                        this._initRequest.query = new tl_1.Api.auth.ImportAuthorization({
                            id: auth.id,
                            bytes: auth.bytes,
                        });
                        const req = new tl_1.Api.InvokeWithLayer({
                            layer: AllTLObjects_1.LAYER,
                            query: this._initRequest
                        });
                        yield sender.send(req);
                    }
                    sender.dcId = dcId;
                    return sender;
                }
                catch (e) {
                    console.log(e);
                    yield sender.disconnect();
                }
            }
            return null;
        });
    }
    getDC(dcId) {
        return __awaiter(this, void 0, void 0, function* () {
            if (!Helpers_1.IS_NODE) {
                switch (dcId) {
                    case 1:
                        return {
                            id: 1,
                            ipAddress: 'pluto.web.telegram.org',
                            port: 443,
                        };
                    case 2:
                        return {
                            id: 2,
                            ipAddress: 'venus.web.telegram.org',
                            port: 443,
                        };
                    case 3:
                        return {
                            id: 3,
                            ipAddress: 'aurora.web.telegram.org',
                            port: 443,
                        };
                    case 4:
                        return {
                            id: 4,
                            ipAddress: 'vesta.web.telegram.org',
                            port: 443,
                        };
                    case 5:
                        return {
                            id: 5,
                            ipAddress: 'flora.web.telegram.org',
                            port: 443,
                        };
                    default:
                        throw new Error(`Cannot find the DC with the ID of ${dcId}`);
                }
            }
            if (!this._config) {
                this._config = yield this.invoke(new tl_1.Api.help.GetConfig());
            }
            for (const DC of this._config.dcOptions) {
                if (DC.id === dcId && !!DC.ipv6 === this._useIPV6) {
                    return {
                        id: DC.id,
                        ipAddress: DC.ipAddress,
                        port: 443,
                    };
                }
            }
            throw new Error(`Cannot find the DC with the ID of ${dcId}`);
        });
    }
    removeSender(dcId) {
        delete this._borrowedSenderPromises[dcId];
    }
    _borrowExportedSender(dcId, retries = 5) {
        return __awaiter(this, void 0, void 0, function* () {
            let senderPromise = this._borrowedSenderPromises[dcId];
            if (!senderPromise) {
                senderPromise = this._createExportedSender(dcId, retries);
                this._borrowedSenderPromises[dcId] = senderPromise;
                senderPromise.then((sender) => {
                    if (!sender) {
                        delete this._borrowedSenderPromises[dcId];
                    }
                });
            }
            return senderPromise;
        });
    }
}
exports.TelegramClient = TelegramClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGVsZWdyYW1DbGllbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9ncmFtanMvY2xpZW50L1RlbGVncmFtQ2xpZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw2REFBd0Q7QUFFeEQsb0RBQXNDO0FBQ3RDLG1EQUFxQztBQUNyQywwREFBNEM7QUFDNUMsNkRBQStDO0FBQy9DLDZEQUErQztBQUMvQywyREFBNkM7QUFDN0MseURBQTJDO0FBQzNDLHlEQUEyQztBQUMzQyxxREFBdUM7QUFDdkMscURBQXVDO0FBRXZDLDhCQUEwQjtBQUMxQixvQ0FBMkM7QUFDM0MscURBQXNEO0FBRXRELHdDQUFnRTtBQUVoRSxxREFBeUM7QUFDekMsd0NBQW1DO0FBR25DLE1BQWEsY0FBZSxTQUFRLHVDQUFrQjtJQUVsRCxjQUFjO0lBRWQsS0FBSyxDQUFDLFVBQWtFO1FBQ3BFLE9BQU8sV0FBVyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVELGtCQUFrQjtRQUNkLE9BQU8sV0FBVyxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFFRCxVQUFVLENBQ04sY0FBMEMsRUFDMUMsVUFBc0M7UUFFdEMsT0FBTyxXQUFXLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxjQUFjLEVBQUUsVUFBVSxDQUFDLENBQUM7SUFDcEUsQ0FBQztJQUVELG9CQUFvQixDQUNoQixjQUEwQyxFQUMxQyxVQUFzQztRQUV0QyxPQUFPLFdBQVcsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLEVBQUUsY0FBYyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0lBQzlFLENBQUM7SUFFRCxRQUFRLENBQUMsY0FBMEMsRUFBRSxXQUFtQixFQUFFLFFBQVEsR0FBRyxLQUFLO1FBQ3RGLE9BQU8sV0FBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsY0FB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