"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MessageButton = void 0;
const api_1 = require("../api");
const button_1 = require("./button");
class MessageButton {
    constructor(client, original, chat, bot, msgId) {
        this.button = original;
        this._bot = bot;
        this._chat = chat;
        this._msgId = msgId;
        this._client = client;
    }
    get client() {
        return this._client;
    }
    get text() {
        return !(this.button instanceof button_1.Button) ? this.button.text : '';
    }
    get data() {
        if (this.button instanceof api_1.Api.KeyboardButtonCallback) {
            return this.button.data;
        }
    }
    get inlineQuery() {
        if (this.button instanceof api_1.Api.KeyboardButtonSwitchInline) {
            return this.button.query;
        }
    }
    get url() {
        if (this.button instanceof api_1.Api.KeyboardButtonUrl) {
            return this.button.url;
        }
    }
    click({ sharePhone = false, shareGeo = [0, 0] }) {
        return __awaiter(this, void 0, void 0, function* () {
            if (this.button instanceof api_1.Api.KeyboardButton) {
                return this._client.sendMessage(this._chat, {
                    message: this.button.text,
                    parseMode: undefined,
                });
            }
            else if (this.button instanceof api_1.Api.KeyboardButtonCallback) {
                const request = new api_1.Api.messages.GetBotCallbackAnswer({
                    peer: this._chat,
                    msgId: this._msgId,
                    data: this.button.data,
                });
                try {
                    return yield this._client.invoke(request);
                }
                catch (e) {
                    if (e.messages == "BOT_RESPONSE_TIMEOUT") {
                        return null;
                    }
                    throw e;
                }
            }
            else if (this.button instanceof api_1.Api.KeyboardButtonSwitchInline) {
                return this._client.invoke(new api_1.Api.messages.StartBot({
                    bot: this._bot,
                    peer: this._chat,
                    startParam: this.button.query
                }));
            }
            else if (this.button instanceof api_1.Api.KeyboardButtonUrl) {
                return this.button.url;
            }
            else if (this.button instanceof api_1.Api.KeyboardButtonGame) {
                const request = new api_1.Api.messages.GetBotCallbackAnswer({
                    peer: this._chat,
                    msgId: this._msgId,
                    game: true,
                });
                try {
                    return yield this._client.invoke(request);
                }
                catch (e) {
                    if (e.messages == "BOT_RESPONSE_TIMEOUT") {
                        return null;
                    }
                    throw e;
                }
            }
            else if (this.button instanceof api_1.Api.KeyboardButtonRequestPhone) {
                if (!sharePhone) {
                    throw new Error('cannot click on phone buttons unless sharePhone=true');
                }
                const me = yield this._client.getMe();
                const phoneMedia = new api_1.Api.InputMediaContact({
                    phoneNumber: me.phone || '',
                    firstName: me.firstName || '',
                    lastName: me.lastName || '',
                    vcard: '',
                });
                throw new Error("Not supported for now");
                // TODO
                //return this._client.sendFile(this._chat, phoneMedia);
            }
            else if (this.button instanceof api_1.Api.InputWebFileGeoPointLocation) {
                if (!shareGeo) {
                    throw new Error("cannot click on geo buttons unless shareGeo=[longitude, latitude]");
                }
                let geoMedia = new api_1.Api.InputMediaGeoPoint({
                    geoPoint: new api_1.Api.InputGeoPoint({ lat: shareGeo[0], long: shareGeo[1] }),
                });
                throw new Error("Not supported for now");
                // TODO
                //return this._client.sendFile(this._chat, geoMedia);
            }
        });
    }
}
exports.MessageButton = MessageButton;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZUJ1dHRvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2dyYW1qcy90bC9jdXN0b20vbWVzc2FnZUJ1dHRvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFFQSxnQ0FBMkI7QUFDM0IscUNBQWdDO0FBRWhDLE1BQWEsYUFBYTtJQU90QixZQUFZLE1BQXNCLEVBQUUsUUFBb0IsRUFBRSxJQUFnQixFQUFFLEdBQWUsRUFBRSxLQUFvQjtRQUM3RyxJQUFJLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQztRQUN2QixJQUFJLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQztRQUNoQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztRQUNwQixJQUFJLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztJQUMxQixDQUFDO0lBRUQsSUFBSSxNQUFNO1FBQ04sT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDO0lBQ3hCLENBQUM7SUFFRCxJQUFJLElBQUk7UUFDSixPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxZQUFZLGVBQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO0lBQ3BFLENBQUM7SUFFRCxJQUFJLElBQUk7UUFDSixJQUFJLElBQUksQ0FBQyxNQUFNLFlBQVksU0FBRyxDQUFDLHNCQUFzQixFQUFFO1lBQ25ELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7U0FDM0I7SUFDTCxDQUFDO0lBRUQsSUFBSSxXQUFXO1FBQ1gsSUFBSSxJQUFJLENBQUMsTUFBTSxZQUFZLFNBQUcsQ0FBQywwQkFBMEIsRUFBRTtZQUN2RCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1NBQzVCO0lBQ0wsQ0FBQztJQUVELElBQUksR0FBRztR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